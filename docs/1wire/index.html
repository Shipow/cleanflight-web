<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      1wire &middot; Cleanflight
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/css/bootstrap.min.css">
  <!-- build:css /assets/stylesheets/style.min.css -->
  <link rel="stylesheet" href="http://localhost:3000/assets/stylesheets/style.css">
  <!-- endbuild -->
  <link href='//fonts.googleapis.com/css?family=Marvel:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css">

  <!-- JS -->
  <!-- build:js /assets/javascript/all.min.js -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script src="//cdn.jsdelivr.net/typeahead.js/0.10.5/typeahead.jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/algoliasearch/3.5.0/algoliasearch.min.js"></script>
  <script src="http://localhost:3000/assets/javascript/javascript.js"></script>
    <script>
    window.baseUrl = 'http://localhost:3000';
    window.algolia = algoliasearch('T2ZX9HO66V', '7119d2f6f1cd95224251ec2e490e824f');
    window.index = algolia.initIndex('dev_cleanflight');
  </script>
  <!-- endbuild -->

  <!-- Icons -->
  <link rel="shortcut icon" href="http://localhost:3000/assets/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <body>
    <nav class="navbar navbar-inverse">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://localhost:3000/"><img src="http://localhost:3000/assets/images/cleanflight-logo.png" height="50"></a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://localhost:3000/docs/getting-started/">Get Started</a></li>
            <li><a href="http://localhost:3000/categories/docs">Documentation</a></li>
            <!-- <li><a href="#">Ressources</a></li> -->
            <li><a href="https://github.com/cleanflight/cleanflight">Contributing</a></li>
          </ul>
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input id="search" type="text" class="form-control" placeholder="Search">
            </div>
          </form>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <div class="container post">

  <div class="row post-full">
    <div class="col-md-9">
      <div class="content">
        <h1>1-wire passthrough esc programming</h1>

<h3>ESCs must have the BlHeli Bootloader.</h3>

<p>If your ESCs didn&rsquo;t come with BlHeli Bootloader, you&rsquo;ll need to flash them with an ArduinoISP programmer first. <a href="http://bit.ly/blheli-f20">Here&rsquo;s a guide</a>.</p>

<p>This is the option you need to select for the bootloader:</p>

<p><img src="http://localhost:3000/assets/images/blheli-bootloader.png" alt="Flashing BlHeli Bootloader"></p>

<p>Currently supported on the SPRACINGF3, STM32F3DISCOVERY, NAZE32 (including clones such as the FLIP32) and CC3D.</p>

<h2>Wiring</h2>

<ul>
<li><p>For the NAZE, no external wiring is necessary. Simply plug in the board via USB cable.</p></li>
<li><p>For the CC3D, connect <a href="http://bit.ly/cf-cp2102">a USB to UART adapter</a> to the flex port.</p>

<ul>
<li>Ensure MSP is enabled on the flex port. Unfortunatly the main port cannot be used in the current configuration due to the inverter on this port.</li>
<li>You&rsquo;ll only need this connection to the CC3D, do not plug in the normal USB connection.</li>
<li>If you need one, I prefer the <a href="http://bit.ly/cf-cp2102">CP2102</a> as it is cheap and <a href="https://www.silabs.com/products/mcu/Pages/USBtoUARTBridgeVCPDrivers.aspx">the driver</a> is readily available.</li>
</ul></li>
<li><p>In the case that your board does not power on fully without a battery attached, it is OK to attach the battery before following the steps below. However, it may not be necessary in all cases.</p></li>
</ul>

<h2>Usage</h2>

<ul>
<li><p>Plug in the USB cable and connect to your board with the CleanFlight configurator.</p>

<ul>
<li>For boards without a built in USB/UART adapter, you&rsquo;ll need to plug an external one in. Here is how you wire up the CC3D. Plug your USB/UART adapter into the Flexi port:</li>
</ul>

<p><img src="http://localhost:3000/assets/images/serial1wire-cc3d-wiring.jpg" alt="Flashing BlHeli Bootloader"></p></li>
<li><p>Open the BlHeli Suite.</p></li>
<li><p>Ensure you have selected the correct Atmel or SILABS &ldquo;Cleanflight&rdquo; option under the &ldquo;Select ATMEL / SILABS Interface&rdquo; menu option.</p></li>
<li><p>Ensure you have port for your external USB/UART adapter selected, if you&rsquo;re using one, otherwise pick the same COM port that you normally use for Cleanflight.</p></li>
<li><p>Click &ldquo;Connect&rdquo; and wait for the connection to complete. If you get a COM error, hit connect again. It will probably work.</p></li>
<li><p>Use the boxes at the bottom to select the ESCs you have connected. Note that the boxes correspond directly to the ports on your flight controller. For example if you have motors on ports 1-4, pick boxes 1-4 or in the case of a tri-copter that uses motors on ports 3, 4 and 5, select those ports in BlHeli.</p></li>
<li><p>Click &ldquo;Read Setup&rdquo;</p></li>
<li><p>Use BlHeli suite as normal.</p></li>
<li><p>When you&rsquo;re finished with one ESC, click &ldquo;Disconnect&rdquo;</p></li>
</ul>

<h2>Implementing and Configuring targets</h2>

<p>The following parameters can be used to enable and configure this in the related target.h file:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">USE_SERIAL_1WIRE              Enables the 1wire code, defined in target.h
</code></pre></div>
<ul>
<li><p>For new targets</p>

<ul>
<li><p>in <code>target.h</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">// Turn on serial 1wire passthrough
#define USE_SERIAL_1WIRE
// How many escs does this board support?
#define ESC_COUNT 6
// STM32F3DISCOVERY TX - PC3 connects to UART RX
#define S1W_TX_GPIO         GPIOC
#define S1W_TX_PIN          GPIO_Pin_3
// STM32F3DISCOVERY RX - PC1 connects to UART TX
#define S1W_RX_GPIO         GPIOC
#define S1W_RX_PIN          GPIO_Pin_1
</code></pre></div></li>
<li><p>in <code>serial_1wire.c</code></p></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">   // Define your esc hardware
   #if defined(STM32F3DISCOVERY) &amp;&amp; !(defined(CHEBUZZF3))
   const escHardware_t escHardware[ESC_COUNT] = {
     { GPIOD, 12 },
     { GPIOD, 13 },
     { GPIOD, 14 },
     { GPIOD, 15 },
     { GPIOA, 1 },
     { GPIOA, 2 }
   };
</code></pre></div></li>
</ul>

<h2>Development Notes</h2>

<p>On the STM32F3DISCOVERY, an external pullup on the ESC line may be necessary. I needed a 3v, 4.7k pullup.</p>

      </div>
    </div>
    <div class="col-md-3">
      <div class="spacer30"></div>
      <h2>Documentation</h2>
      <ul class="posts list-unstyled">
        
        
          
            <li><a href="http://localhost:3000//docs/1wire">1wire</a></li>
          
        
          
        
          
            <li><a href="http://localhost:3000//docs/autotune">Autotune</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/battery">Battery</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/blackbox">Blackbox</a></li>
          
        
          
        
          
            <li><a href="http://localhost:3000//docs/board---alienwii32">Board   Alienwii32</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---cc3d">Board   Cc3d</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---chebuzzf3">Board   Chebuzzf3</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---cjmcu">Board   Cjmcu</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---colibrirace">Board   Colibrirace</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---motolab">Board   Motolab</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---naze32">Board   Naze32</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---olimexino">Board   Olimexino</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---paris-air-hero-32">Board   Paris Air Hero 32</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---rmdo">Board   Rmdo</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---sparky">Board   Sparky</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/board---spracingf3">Board   Spracingf3</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/boards">Boards</a></li>
          
        
          
        
          
        
          
        
          
        
          
        
          
            <li><a href="http://localhost:3000//docs/buzzer">Buzzer</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/cli">Cli</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/configuration">Configuration</a></li>
          
        
          
        
          
            <li><a href="http://localhost:3000//docs/controls">Controls</a></li>
          
        
          
        
          
            <li><a href="http://localhost:3000//docs/display">Display</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/failsafe">Failsafe</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/getting-started">Getting Started</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/gps">Gps</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/gtune">Gtune</a></li>
          
        
          
        
          
        
          
            <li><a href="http://localhost:3000//docs/inflight-adjustments">Inflight Adjustments</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/installation">Installation</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/introduction">Introduction</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/ledstrip">Ledstrip</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/migrating-from-baseflight">Migrating From Baseflight</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/mixer">Mixer</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/modes">Modes</a></li>
          
        
          
        
          
            <li><a href="http://localhost:3000//docs/oneshot">Oneshot</a></li>
          
        
          
        
          
            <li><a href="http://localhost:3000//docs/pid-tuning">Pid Tuning</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/profiles">Profiles</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/rssi">Rssi</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/rx">Rx</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/safety">Safety</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/serial">Serial</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/sonar">Sonar</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/spektrum-bind">Spektrum Bind</a></li>
          
        
          
            <li><a href="http://localhost:3000//docs/telemetry">Telemetry</a></li>
          
        
          
        
          
            <li><a href="http://localhost:3000//docs/usb-flashing">Usb Flashing</a></li>
          
        
      </ul>
      
        <div class="catbloc" id="docs">
          
          
        </div>
      
        <div class="catbloc" id="development">
          
          
            <h3>development</h3>
            <ul class="posts list-unstyled">
              
                
                  
                
              
                
                  
                    <li>
                      <a href="/docs/development/travis">
                        Travis
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/pid-internals">
                        Pid Internals
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/hardware-debugging-in-eclipse">
                        Hardware Debugging In Eclipse
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/hardware-debugging">
                        Hardware Debugging
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/development">
                        Development
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/configuration-storage">
                        Configuration Storage
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/building-manual">
                        Building Manual
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/building-in-windows">
                        Building In Windows
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/building-in-ubuntu">
                        Building In Ubuntu
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/building-in-mac-os-x">
                        Building In Mac Os X
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/building-in-eclipse">
                        Building In Eclipse
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/blackbox-internals">
                        Blackbox Internals
                      </a>
                    </li>
                  
                
                  
                    <li>
                      <a href="/docs/development/atomic-barrier">
                        Atomic Barrier
                      </a>
                    </li>
                  
                
              
            </ul>
          
        </div>
      
        <div class="catbloc" id="api">
          
          
            <h3>api</h3>
            <ul class="posts list-unstyled">
              
                
                  
                
              
                
                  
                    <li>
                      <a href="/docs/api/msp_extensions">
                        Msp_extensions
                      </a>
                    </li>
                  
                
              
            </ul>
          
        </div>
      
    </div>
  </div>
</div>
    <footer class="footer text-center">
      <i class="fa fa-copyright"></i> 2015 Cleanflight Team
    </footer>
  </body>
</html>
